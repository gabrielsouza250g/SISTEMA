<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unilanches - O Sabor da Universidade!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="topbar">
        <div class="container">
            <div class="logo-area">
                <a href="index.html">
                    <img src="imagens/logo.png" onerror="this.onerror=null;this.src='https://placehold.co/180x50/E63946/FFFFFF?text=Unilanches&font=Poppins';" alt="Unilanches Logo" class="logo-img">
                </a>
            </div>
            <nav id="mainNav"> 
                <a href="index.html" class="nav-link active">Início</a>
                <a href="cardapio.html" class="nav-link">Cardápio</a>
                <a href="#como-funciona" class="nav-link">Como Pedir</a>
                <span id="userAuthLinksIndex"> 
                    <!-- Links de Entrar/Registrar ou Saudação/Sair serão inseridos aqui pelo script.js -->
                </span>
            </nav>
            <button class="mobile-nav-toggle" aria-label="Abrir menu" aria-expanded="false" aria-controls="mainNav">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container hero-container">
                <div class="hero-content">
                    <h1>Seu Lanche Universitário <span class="highlight">Favorito</span>, a Um Clique!</h1>
                    <p class="subtitle">Fome na correria da faculdade? Peça no Unilanches e receba seu pedido quentinho e delicioso sem sair do campus. Rápido, fácil e com o sabor que você já conhece!</p>
                    <a href="cardapio.html" class="button-hero-cta">Ver Cardápio Agora <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="hero-image-area">
                    <img src="/imagens/coxinha2.png" onerror="this.onerror=null;this.src='https://placehold.co/550x450/F4A261/2B2D42?text=Lanches+Deliciosos&font=Poppins';" alt="Lanches Deliciosos Unilanches" class="hero-main-img animated">
                </div>
            </div>
        </section>

        <section class="categories-section">
            <div class="container">
                <h2 class="section-title">Explore por <span class="highlight">Categorias</span></h2>
                <p class="section-subtitle">Encontre rapidamente o que você mais deseja.</p>
                <div class="category-grid" id="categoryGridIndex">
                    <p>Carregando categorias...</p>
                </div>
            </div>
        </section>

        <section id="produtos" class="produtos">
            <div class="container">
                <h2 class="section-title">Os <span class="highlight">Queridinhos</span> da Galera</h2>
                <p class="section-subtitle">Experimente nossos campeões de pedidos e descubra o seu novo lanche favorito!</p>
                
                <div class="category-filters" id="categoryFiltersIndex" style="margin-bottom: 2.5rem; text-align: center; display:flex; flex-wrap:wrap; justify-content:center; gap: 0.5rem;">
                    <!-- Botão “Todos” já ativo por padrão -->
                    <button class="filter-btn active" data-slug="todos" onclick="filterProductsIndex('todos')">Todos</button>
                    <!-- Botões de categoria serão inseridos via carregarCategoriasIndex() -->
                </div>
                
                <div class="produto-lista" id="produtoListaIndex">
                    <p>Carregando cardápio...</p>
                </div>

                <div class="text-center mt-3" style="margin-top: 2.5rem;">
                     <a href="cardapio.html" class="button-secondary">Ver Cardápio Completo <i class="fas fa-eye"></i></a>
                </div>
            </div>
        </section>

        <section class="features-section">
            <div class="container">
                <h2 class="section-title">Por que pedir no <span class="highlight">Unilanches</span>?</h2>
                <p class="section-subtitle">Sabor, praticidade e o carinho que só a gente tem!</p>
                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon"><i class="fas fa-bolt"></i></div>
                        <h3>Rapidez na Fila</h3>
                        <p>Peça pelo site e retire sem demora. Seu tempo é precioso!</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon"><i class="fas fa-leaf"></i></div>
                        <h3>Ingredientes Frescos</h3>
                        <p>Priorizamos ingredientes de qualidade para um sabor inesquecível.</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon"><i class="fas fa-tags"></i></div>
                        <h3>Preço Amigo</h3>
                        <p>Sabor que cabe no seu bolso de estudante, com promoções especiais.</p>
                    </div>
                     <div class="feature-item">
                        <div class="feature-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <h3>Bem Pertinho</h3>
                        <p>Localização estratégica no campus para sua maior comodidade.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="como-funciona" class="how-it-works-section">
            <div class="container">
                <h2 class="section-title">Pedir é <span class="highlight">Moleza</span>!</h2>
                <p class="section-subtitle">Siga estes passos simples e saboreie seu lanche.</p>
                <div class="steps-grid">
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <i class="fas fa-mouse-pointer step-icon"></i>
                        <h3>Escolha Seus Lanches</h3>
                        <p>Navegue pelo nosso cardápio online e adicione suas delícias favoritas ao carrinho.</p>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <i class="fas fa-credit-card step-icon"></i>
                        <h3>Pague Online</h3>
                        <p>Segurança e praticidade: aceitamos PIX e cartão diretamente no site.</p>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <i class="fas fa-receipt step-icon"></i> 
                        <h3>Retire no Balcão</h3>
                        <p>Apresente o comprovante do pedido e retire seu lanche quentinho, sem filas!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <img src="https://placehold.co/160x45/EFEBE8/3D3A37?text=Unilanches&font=Poppins" alt="Unilanches Logo Rodapé" class="footer-logo">
                    <p>Matando sua fome na universidade com sabor e praticidade. Lanches feitos com carinho para a comunidade acadêmica!</p>
                </div>
                <div class="footer-links">
                    <h4>Links Úteis</h4>
                    <ul>
                        <li><a href="cardapio.html">Cardápio Completo</a></li>
                        <li><a href="login.html">Minha Conta</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Fale Conosco</h4>
                    <p><i class="fas fa-map-marker-alt"></i> Cantina Central, UNIFUCAMP</p>
                    <p><i class="fas fa-phone"></i> (34) 99999-9999</p>
                    <p><i class="fas fa-envelope"></i> contato@unilanches.com.br</p>
                    <div class="social-icons">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Whatsapp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024-2025 Unilanches. Todos os direitos reservados. Desenvolvido por Alunos de Ciencias Da Computação.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        const API_URL_INDEX = '/api'; 
        let userIsLoggedInIndex = false;

        // Atualiza os links de login / perfil no cabeçalho do index
        function updateUserAuthLinksIndex(isLoggedIn, userName, userType) {
            userIsLoggedInIndex = isLoggedIn;
            const authLinksSpan = document.getElementById('userAuthLinksIndex');
            if (authLinksSpan) {
                if (isLoggedIn) {
                    authLinksSpan.innerHTML = `
                        <span class="nav-link">Olá, <strong>${userName}!</strong></span>
                        <a href="${userType === 'funcionario' ? 'administracao.html' : 'home.html'}" class="nav-link">Meu Painel</a>
                        <a href="#" class="nav-link sair-btn" onclick="logout()">Sair</a>
                    `;
                } else {
                    authLinksSpan.innerHTML = `
                        <a href="login.html" class="nav-link">Entrar</a>
                        <a href="register.html" class="button-cta">Criar Conta</a>
                    `;
                }
            }
        }
        
        // Verifica status de login / preenche nome
        async function checkLoginStatusIndex() {
            try {
                const response = await fetch(`${API_URL_INDEX}/status`);
                const data = await response.json();
                updateUserAuthLinksIndex(data.logado, data.nome, data.tipo);
            } catch (error) {
                console.error("Erro ao verificar status da sessão no index.html:", error);
                updateUserAuthLinksIndex(false, null, null);
            }
        }

        // Carrega todas as categorias para o index
        async function carregarCategoriasIndex() {
            const categoryGrid = document.getElementById('categoryGridIndex');
            const categoryFilters = document.getElementById('categoryFiltersIndex');
            if (!categoryGrid || !categoryFilters) return;

            categoryGrid.innerHTML = '<p>Carregando categorias...</p>';
            // Remove botões antigos (exceto “Todos”)
            const existingFilters = categoryFilters.querySelectorAll('.filter-btn[data-slug]:not([data-slug="todos"])');
            existingFilters.forEach(btn => btn.remove());

            try {
                const response = await fetch(`${API_URL_INDEX}/categorias`);
                if (!response.ok) throw new Error('Falha ao buscar categorias');
                const categorias = await response.json();

                categoryGrid.innerHTML = '';
                if (categorias.length === 0) {
                    categoryGrid.innerHTML = '<p>Nenhuma categoria encontrada.</p>';
                    return;
                }

                categorias.forEach(cat => {
                    // Adiciona o card de categoria
                    const categoryLink = document.createElement('a');
                    categoryLink.href = "#produtos"; 
                    categoryLink.classList.add('category-card');
                    categoryLink.onclick = (event) => {
                        event.preventDefault();
                        filterProductsIndex(cat.slug);
                        document.getElementById('produtos').scrollIntoView({ behavior: 'smooth' });
                    };

                    const imgCat = cat.imagem_url
                        || `https://placehold.co/250x180/DDDDDD/777777?text=${encodeURIComponent(cat.nome)}&font=Poppins`;

                    categoryLink.innerHTML = `
                        <img src="${imgCat}" alt="${cat.nome}"
                             onerror="this.onerror=null;this.src='https://placehold.co/250x180/CCCCCC/969696?text=Imagem+Indisponível&font=Poppins';">
                        <h3>${cat.nome}</h3>
                    `;
                    categoryGrid.appendChild(categoryLink);

                    // Cria botão de filtro
                    const filterButton = document.createElement('button');
                    filterButton.classList.add('filter-btn');
                    filterButton.setAttribute('data-slug', cat.slug);
                    filterButton.textContent = cat.nome;
                    filterButton.onclick = () => filterProductsIndex(cat.slug);
                    categoryFilters.appendChild(filterButton);
                });

            } catch (error) {
                console.error("Erro ao carregar categorias:", error);
                categoryGrid.innerHTML = '<p style="color:red;">Erro ao carregar categorias.</p>';
            }
        }

        // Carrega produtos para o index
        async function carregarProdutosIndex() {
            const produtoListaDiv = document.getElementById('produtoListaIndex');
            if (!produtoListaDiv) return;
            produtoListaDiv.innerHTML = '<p>Carregando cardápio...</p>';

            try {
                const response = await fetch(`${API_URL_INDEX}/produtos`);
                if (!response.ok) {
                    const errData = await response.json().catch(() => ({ message: `Erro HTTP: ${response.status}` }));
                    throw new Error(errData.message || `Erro ao buscar produtos: ${response.statusText}`);
                }
                const produtos = await response.json();
                window.todosOsProdutosIndex = produtos;

                // Exibe inicialmente só os 6 primeiros produtos
                renderizarProdutosFiltradosIndex('todos');

            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                produtoListaDiv.innerHTML = `<p style="color: red;">Erro ao carregar o cardápio: ${error.message}</p>`;
            }
        }

        // Exibe produtos filtrados (limitando a 6)
        function renderizarProdutosFiltradosIndex(categoriaSlug) {
            const produtoListaDiv = document.getElementById('produtoListaIndex');
            produtoListaDiv.innerHTML = '';

            let produtosFiltrados = categoriaSlug === 'todos'
                ? window.todosOsProdutosIndex
                : window.todosOsProdutosIndex.filter(p => p.slug_categoria === categoriaSlug);

            // Limita a exibir apenas 6 produtos
            produtosFiltrados = produtosFiltrados.slice(0, 6);

            if (produtosFiltrados.length === 0) {
                let noMatchMsg = document.getElementById('noMatchMessageIndex');
                if (!noMatchMsg) {
                    noMatchMsg = document.createElement('p');
                    noMatchMsg.id = 'noMatchMessageIndex';
                    noMatchMsg.style.textAlign = 'center';
                    noMatchMsg.style.width = '100%';
                    noMatchMsg.style.padding = '1rem 0';
                    produtoListaDiv.appendChild(noMatchMsg);
                }
                const botoesCategoria = document.querySelectorAll('#categoryFiltersIndex .filter-btn');
                const categoriaSelecionada = Array.from(botoesCategoria).find(btn => btn.classList.contains('active'));
                const nomeCat = categoriaSelecionada && categoriaSelecionada.getAttribute('data-slug') !== 'todos'
                    ? `"${categoriaSelecionada.textContent}"`
                    : '';
                noMatchMsg.textContent = `Nenhum produto encontrado ${nomeCat}.`;
                noMatchMsg.style.display = 'block';
                return;
            } else {
                let noMatchMsg = document.getElementById('noMatchMessageIndex');
                if (noMatchMsg) noMatchMsg.style.display = 'none';
            }

            produtosFiltrados.forEach(produto => {
                const produtoItem = document.createElement('div');
                produtoItem.classList.add('produto-item');
                produtoItem.dataset.category = produto.slug_categoria || 'sem-categoria';

                const imagemProduto = produto.imagem_url
                    || `https://placehold.co/300x200/CCCCCC/969696?text=${encodeURIComponent(produto.nome)}&font=Poppins`;

                const acaoBotao = `handleAdicionarAoCarrinhoGenerico(${produto.id}, ${window.globalUserStatus ? window.globalUserStatus.logado : false})`;

                produtoItem.innerHTML = `
                    <img src="${imagemProduto}" alt="${produto.nome}"
                         onerror="this.onerror=null;this.src='https://placehold.co/300x200/CCCCCC/969696?text=Img+Indisponível&font=Poppins';">
                    <div class="produto-info">
                        <h3>${produto.nome}</h3>
                        <p class="produto-descricao">${produto.descricao_longa || 'Sem descrição.'}</p>
                        <div class="produto-preco-rating">
                            <span class="produto-preco">R$${parseFloat(produto.preco_venda).toFixed(2).replace('.', ',')}</span>
                        </div>
                        <button class="btn-adicionar" onclick="${acaoBotao}"><i class="fas fa-cart-plus"></i> Adicionar</button>
                    </div>
                `;
                produtoListaDiv.appendChild(produtoItem);
            });
        }

        // Função de filtragem específica para o index
        function filterProductsIndex(categoriaSlug) {
            // Atualiza “active” nos botões
            const botoes = document.querySelectorAll('#categoryFiltersIndex .filter-btn');
            botoes.forEach(btn => btn.classList.remove('active'));
            const btnAtivo = Array.from(botoes).find(btn => btn.getAttribute('data-slug') === categoriaSlug);
            if (btnAtivo) btnAtivo.classList.add('active');

            renderizarProdutosFiltradosIndex(categoriaSlug);
        }

        // Ao carregar a página index, preenche categorias, filtros e produtos
        document.addEventListener('DOMContentLoaded', async () => {
            await checkLoginStatusIndex();
            await carregarCategoriasIndex();
            await carregarProdutosIndex();
        });
    </script>
</body>
</html>
